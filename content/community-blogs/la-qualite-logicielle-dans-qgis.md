---
source: "blog"
title: "QGIS Oslandia: Software quality in QGIS"
image: "la-qualite-logicielle-dans-qgis."
date: "2024-02-07"
link: "https://oslandia.com/en/2024/02/09/la-qualite-logicielle-dans-qgis/"
draft: "true"
showcase: "planet"
---

<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">According to the definition of software quality given by french Wikipedia</span></span> </span></p>
<blockquote><p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">An overall assessment of quality takes into account external factors, directly observable by the user, as well as internal factors, observable by engineers during code reviews or maintenance work.</span></span> </span></p></blockquote>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">I have chosen in this article to only talk about the latter.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">The quality of software and more precisely QGIS is therefore not limited to what is described here.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">There is still much to say about:</span></span> </span></p>
<ul>
<li><span class="HwtZe" lang="en"> <span class="jCAhz ChMk0b"><span class="ryNqvb">Taking user feedback into account,</span></span> </span></li>
<li><span class="HwtZe" lang="en"> <span class="jCAhz ChMk0b"><span class="ryNqvb">the documentation writing process,</span></span> </span></li>
<li><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">translation management,</span></span> </span></li>
<li><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">interoperability through the implementation of standards,</span></span> </span></li>
<li><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">the extensibility using API,</span></span> </span></li>
<li><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">the reversibility and resilience of the open source model&#8230;</span></span></span></li>
</ul>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">These are subjects that we care a lot and deserve their own article.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">I will focus here on the following issue: QGIS is free software and allows anyone with the necessary skills to modify the software.</span></span> <strong><span class="jCAhz ChMk0b"><span class="ryNqvb">But how can we ensure that the multiple proposals for modifications to the software contribute to its improvement and do not harm its future maintenance?</span></span> </strong></span></p>
<h1><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Self-discipline</span></span> </span></h1>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">All developers contributing to QGIS code doesn&#8217;t belong to the same organization.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">They don&#8217;t all live in the same country, don&#8217;t necessarily have the same culture and don&#8217;t necessarily share the same interests or ambitions for the software.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">However, they share the awareness of modifying a common good and the desire to take care of it.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">This awareness transcends professional awareness, the developer not only has a responsibility towards his employer, but also towards the entire community of users and contributors to the software.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">T</span></span></span><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">his self-discipline is the foundation of the quality of the contributions of software like QGIS.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">However, to err is human and it is essential to carry out checks for each modification proposal.</span></span> </span></p>
<h1><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Automatic checks</span></span> </span></h1>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">With each <a href="https://github.com/qgis/QGIS/pulls">modification proposal</a> (called Pull Request or Merge Request), the QGIS GitHub platform automatically launches a set of automatic checks.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb"><img class="size-full wp-image-8154 aligncenter" src="https://oslandia.com/wp-content/uploads/2024/01/gh_example.png" alt="" width="731" height="260" srcset="https://oslandia.com/wp-content/uploads/2024/01/gh_example.png 731w, https://oslandia.com/wp-content/uploads/2024/01/gh_example-300x107.png 300w" sizes="(max-width: 731px) 100vw, 731px" /></span></span></span></p>
<p style="text-align: center;"><em><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Example of proposed modification</span></span> </span></em></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb"><img class="size-full wp-image-8156 aligncenter" src="https://oslandia.com/wp-content/uploads/2024/01/gh_checks.png" alt="" width="681" height="247" srcset="https://oslandia.com/wp-content/uploads/2024/01/gh_checks.png 681w, https://oslandia.com/wp-content/uploads/2024/01/gh_checks-300x109.png 300w" sizes="(max-width: 681px) 100vw, 681px" /></span></span></span></p>
<p style="text-align: center;"><em><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Result of automatic checks on a modification proposal</span></span></span></em></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">The first of these checks is to build QGIS on the different systems on which it is distributed (Linux, Windows, MacOS) by integrating the proposed modification.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">It is inconceivable to integrate a modification that would prevent the application from being built on one of these systems.</span></span> </span></p>
<h2><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">The tests</span></span> </span></h2>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">The first problem posed by a proposed modification is the following <strong>&#8220;How can we be sure that what is going to be introduced does not break what already exists?&#8221;</strong></span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">To validate this assertion, we rely on automatic tests.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">This is a set of micro-programs called tests, which only purpose is to validate that part of the application behaves as expected.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">For example, there is a test which validates that when the user adds an entry in a data layer, then this entry is then present in the data layer.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">If a modification were to break this behavior, then the test would fail and the proposal would be rejected (or more likely corrected).</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">This makes it possible in particular to avoid regressions (they are very often called <em>non-regression tests</em>) and also to qualify the expected behavior.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">There are approximately 1.3 Million lines of code for the QGIS application and 420K lines of test code, a ratio of 1 to 3. The presence of tests is mandatory for adding functionality, therefore the</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">quantity of test code increases with the quantity of application code.</span></span> </span></p>
<p><img class="size-full wp-image-8159 aligncenter" src="https://oslandia.com/wp-content/uploads/2024/01/codevstest_graph.png" alt="" width="566" height="332" srcset="https://oslandia.com/wp-content/uploads/2024/01/codevstest_graph.png 566w, https://oslandia.com/wp-content/uploads/2024/01/codevstest_graph-300x176.png 300w" sizes="(max-width: 566px) 100vw, 566px" /></p>
<p style="text-align: center;"><em><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">In blue the number of lines of code in QGIS, in red the number of lines of tests</span></span></span></em></p>
<p><span class="HwtZe" lang="en"> <span class="jCAhz ChMk0b"><span class="ryNqvb">There are currently over 900 groups of automatic tests in QGIS, most of which run in less than 2 seconds, for a total execution time of around 30 minutes.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">We also see that certain parts of the QGIS code &#8211; the most recent &#8211; are better covered by the tests than other older ones.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">Developers are gradually working to improve this situation to reduce technical debt.</span></span> </span></p>
<h2><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Code checks</span></span> </span></h2>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Analogous to using a spell checker when writing a document, we carry out a set of quality checks on the source code.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">We check, for example, that the proposed modification does not contain misspelled words or &#8220;banned&#8221; words, that the API documentation has been correctly written or that the modified code respects certain formal rules of the programming language.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">We recently had the opportunity to add a check based on </span></span></span><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">the <a href="https://clang.llvm.org/extra/clang-tidy/">clang-tidy</a> tool. </span></span></span><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">The latter relies on the <a href="https://fr.wikipedia.org/wiki/Clang">Clang</a> compiler.</span></span> </span><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">It is capable of detecting programming errors by carrying out a static analysis of the code.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Clang-tidy is, for example, capable of detecting “narrowing conversions”.</span></span> </span></p>
<p><img class="size-full wp-image-8160 aligncenter" src="https://oslandia.com/wp-content/uploads/2024/01/narrowing_conversion.png" alt="" width="1142" height="71" srcset="https://oslandia.com/wp-content/uploads/2024/01/narrowing_conversion.png 1142w, https://oslandia.com/wp-content/uploads/2024/01/narrowing_conversion-300x19.png 300w, https://oslandia.com/wp-content/uploads/2024/01/narrowing_conversion-768x48.png 768w, https://oslandia.com/wp-content/uploads/2024/01/narrowing_conversion-1024x64.png 1024w" sizes="(max-width: 1142px) 100vw, 1142px" /></p>
<p style="text-align: center;"><em><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Example of detecting “narrowing conversions”</span></span></span></em></p>
<p><span class="HwtZe" lang="en"> <span class="jCAhz ChMk0b"><span class="ryNqvb">In the example above, Clang-tidy detects that there has been a &#8220;narrowing conversion&#8221; and that the value of the port used in the network proxy configuration &#8220;may&#8221; be corrupted.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">In this case, this problem was <a href="https://github.com/qgis/QGIS/issues/49179">reported</a> on the QGIS issues platform and had to be <a href="https://github.com/qgis/QGIS/pull/50016">corrected</a>.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">At that time, clang-tidy was not in place.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">Its use would have made it possible to avoid this anomaly and all the steps which led to its correction (exhaustive description of the issue, multiple exchanges to be able to reproduce it, investigation, correction, review of the modification), meaning a significant amount of </span></span><span class="jCAhz ChMk0b"><span class="ryNqvb">human time which could thus have been avoided.</span></span></span></p>
<h1><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Peer review</span></span> </span></h1>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">A proposed modification that would validate all of the automatic checks described above would not necessarily be integrated into the QGIS code automatically.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">In fact, its code may be poorly designed or the modification poorly thought out.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">The relevance of the functionality may be doubtful, or duplicated with another.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">The integration of the modification would therefore potentially cause a burden for the people in charge of the corrective or evolutionary maintenance of the software.</span></span></span></p>
<p><span class="HwtZe" lang="en"> <span class="jCAhz ChMk0b"><span class="ryNqvb">It is therefore essential to include a human review in the process of accepting a modification.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">This is more of a rereading of the substance of the proposal than of the form.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">For the latter, we favor the automatic checks described above in order to simplify the review process.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Therefore, human proofreading takes time, and this effort is growing with the quantity of modifications proposed in the QGIS code.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">The question of its funding arises, and discussions are <a href="https://lists.osgeo.org/pipermail/qgis-developer/2023-December/066299.html">in progress</a>.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">The QGIS.org association notably dedicates a significant part of its budget to fund code reviews.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb"><img class="size-full wp-image-8161 aligncenter" src="https://oslandia.com/wp-content/uploads/2024/01/gh_report.png" alt="" width="726" height="328" srcset="https://oslandia.com/wp-content/uploads/2024/01/gh_report.png 726w, https://oslandia.com/wp-content/uploads/2024/01/gh_report-300x136.png 300w" sizes="(max-width: 726px) 100vw, 726px" /></span></span></span></p>
<p style="text-align: center;"><em><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">More than 100 modification proposals were reviewed and integrated during the month of December 2023. More than 30 different people contributed.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">More than 2000 files have been modified.</span></span> </span></em></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">Therefore the wait for a proofreading can sometimes be long.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">It is also often the moment when disagreements are expressed.</span></span> <span class="jCAhz ChMk0b"><span class="ryNqvb">It is therefore a phase which can prove frustrating for contributors, but it is an important and rich moment in the community life of a free project.</span></span> </span></p>
<p><strong><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">To be continued !</span></span> </span></strong></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">As a core QGIS developer, and as a pure player OpenSource company, we believe it is fundamental to be involved in each step of the contribution process.</span></span> </span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">We are investing in the review process, improving automatic checks, and in the QGIS quality process in general. </span></span></span><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">And we will continue to invest in these topics in order to help make QGIS a long-lasting and stable software.</span></span></span></p>
<p><span class="HwtZe" lang="en"><span class="jCAhz ChMk0b"><span class="ryNqvb">If you would like to contribute or simply learn more about QGIS, do not hesitate to contact us at <a href="mailto:infos+qgis@oslandia.com">infos+qgis@oslandia.com</a> and consult our QGIS<a href="https://oslandia.com/offre-qgis/"> support proposal</a>.</span></span></span></p>
